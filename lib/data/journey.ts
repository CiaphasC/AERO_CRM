import type { DiagramBlueprint } from "@/lib/types/diagram";

const journeyBlueprint: DiagramBlueprint = {
  id: "crm-journey-blueprint",
  lockDiagram: true,
  defaultLinkColor: "#38bdf8",
  defaultLinkWidth: 2.2,
  defaultCurvyness: 36,
  canvas: {
    height: 680,
  },
  nodes: [
    {
      id: "contact",
      label: "Cliente en WhatsApp",
      subtitle: "Consulta inicial desde el canal oficial de la marca.",
      color: "#0ea5e9",
      accent: "#38bdf8",
      position: { x: 40, y: 260 },
      outPorts: ["mensaje"],
    },
    {
      id: "webhook",
      label: "Webhook Next.js",
      subtitle: "Normaliza payloads y aplica reglas anti-spam.",
      color: "#2563eb",
      accent: "#60a5fa",
      position: { x: 300, y: 260 },
      inPorts: ["webhook"],
      outPorts: ["evento limpio"],
    },
    {
      id: "router",
      label: "Router de journeys n8n",
      subtitle: "Clasifica la intención y activa el flujo adecuado.",
      color: "#9333ea",
      accent: "#a855f7",
      position: { x: 560, y: 260 },
      inPorts: ["evento"],
      outPorts: ["visa", "vuelo", "crm"],
    },
    {
      id: "visa-flow",
      label: "WhatsApp Flow Visa",
      subtitle: "Recopila requisitos y valida la elegibilidad.",
      color: "#0891b2",
      accent: "#22d3ee",
      position: { x: 820, y: 120 },
      inPorts: ["activar"],
      outPorts: ["resumen"],
    },
    {
      id: "flight-flow",
      label: "Formulario de vuelo",
      subtitle: "Capta fechas, pasajeros y preferencias.",
      color: "#0ea5e9",
      accent: "#38bdf8",
      position: { x: 820, y: 400 },
      inPorts: ["activar"],
      outPorts: ["solicitud"],
    },
    {
      id: "supabase",
      label: "Supabase CRM",
      subtitle: "Centraliza expedientes y dispara eventos internos.",
      color: "#10b981",
      accent: "#34d399",
      position: { x: 1080, y: 260 },
      inPorts: ["guardar"],
      outPorts: ["expediente", "metricas"],
    },
    {
      id: "agent",
      label: "Panel de agentes",
      subtitle: "Distribuye casos y prioriza según SLA.",
      color: "#6366f1",
      accent: "#818cf8",
      position: { x: 1340, y: 260 },
      inPorts: ["caso"],
      outPorts: ["respuesta"],
    },
    {
      id: "customer-done",
      label: "Cliente informado",
      subtitle: "Recibe propuestas validadas y seguimiento.",
      color: "#f97316",
      accent: "#fb923c",
      position: { x: 1580, y: 260 },
      inPorts: ["mensaje"],
    },
    {
      id: "metrics",
      label: "Panel de métricas",
      subtitle: "Registra tiempos, conversiones y NPS.",
      color: "#facc15",
      accent: "#fde047",
      position: { x: 1080, y: 520 },
      inPorts: ["evento"],
    },
  ],
  links: [
    {
      id: "contact-webhook",
      from: "contact",
      to: "webhook",
      label: "Mensaje entrante",
    },
    {
      id: "webhook-router",
      from: "webhook",
      to: "router",
      label: "Evento normalizado",
    },
    {
      id: "router-visa",
      from: "router",
      to: "visa-flow",
      label: "Rama visa",
      fromPort: "visa",
      toPort: "activar",
    },
    {
      id: "router-flight",
      from: "router",
      to: "flight-flow",
      label: "Rama vuelo",
      fromPort: "vuelo",
      toPort: "activar",
    },
    {
      id: "visa-supabase",
      from: "visa-flow",
      to: "supabase",
      label: "Datos validados",
      toPort: "guardar",
    },
    {
      id: "flight-supabase",
      from: "flight-flow",
      to: "supabase",
      label: "Solicitud completa",
      toPort: "guardar",
    },
    {
      id: "router-supabase",
      from: "router",
      to: "supabase",
      label: "Actualiza CRM",
      fromPort: "crm",
      toPort: "guardar",
    },
    {
      id: "supabase-agent",
      from: "supabase",
      to: "agent",
      label: "Caso asignado",
      fromPort: "expediente",
      toPort: "caso",
    },
    {
      id: "agent-customer",
      from: "agent",
      to: "customer-done",
      label: "Respuesta humana",
      fromPort: "respuesta",
      toPort: "mensaje",
    },
    {
      id: "supabase-metrics",
      from: "supabase",
      to: "metrics",
      label: "Evento registrado",
      fromPort: "metricas",
      toPort: "evento",
    },
  ],
};

export async function getJourneyBlueprint(): Promise<DiagramBlueprint> {
  return journeyBlueprint;
}
